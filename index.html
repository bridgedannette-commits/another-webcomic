<!doctype html>
<html lang="ru" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDF Comic Reader</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    html, body {
      height: 100%;
      overflow: hidden; /* ❗ убираем скролл */
    }

    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .fade-in {
      animation: fadeIn 0.5s ease;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .spinner {
      border: 3px solid rgba(255,255,255,0.3);
      border-top-color: #8b5cf6;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      animation: spin 0.8s linear infinite;
    }

    .progress-bar {
      position: absolute;
      top: 0;
      left: 0;
      height: 3px;
      transition: width 0.3s ease;
      z-index: 10;
    }

    button:active {
      transform: scale(0.95);
    }
  </style>
</head>

<body class="h-full">
<div id="app-wrapper" class="w-full h-full">

  <!-- Loading -->
  <div id="loading-screen" class="w-full h-full flex flex-col items-center justify-center">
    <div class="spinner mb-4"></div>
    <p id="loading-text" class="text-lg">Загрузка комикса...</p>
  </div>

  <!-- Reader -->
  <div id="reader-screen" class="w-full h-full hidden flex-col relative">

    <div id="progress-bar" class="progress-bar"></div>

    <div id="header" class="flex items-center justify-between px-6 py-4 shadow-md">
      <h2 id="comic-title" class="text-xl font-bold truncate flex-1">Comic Reader</h2>
    </div>

    <div id="canvas-wrapper" class="flex-1 relative overflow-hidden">
      <div id="canvas-container" class="w-full h-full flex items-center justify-center p-4 relative">
        <canvas id="pdf-canvas-1" class="max-w-full max-h-full absolute"></canvas>
        <canvas id="pdf-canvas-2" class="max-w-full max-h-full absolute opacity-0"></canvas>
      </div>
    </div>

    <!-- CONTROLS (FIXED) -->
    <div id="controls-wrapper"
         class="fixed bottom-0 left-0 w-full z-50"
         style="transition: transform 0.3s ease, opacity 0.3s ease;">
      <div id="controls" class="flex items-center justify-center gap-2 px-8 py-4 shadow-lg">

        <button id="prev-btn" style="width:48px;height:48px;border-radius:50%">
          ◀
        </button>

        <div id="page-indicator" class="px-4 py-2 rounded-lg">
          <span id="current-page">1</span> /
          <span id="total-pages">1</span>
        </div>

        <button id="next-btn" style="width:48px;height:48px;border-radius:50%">
          ▶
        </button>

        <button id="fullscreen-btn" class="ml-4">⛶</button>

        <button id="hide-controls-btn" class="ml-4">⬇</button>
      </div>
    </div>

    <!-- SHOW BUTTON -->
    <button id="show-controls-btn"
            class="hidden fixed bottom-0 left-1/2 -translate-x-1/2 px-6 py-2 rounded-t-lg shadow-lg z-50">
      ⬆
    </button>

  </div>
</div>

<script>
/* =================== FIX: hide / show controls =================== */

const hideBtn = document.getElementById('hide-controls-btn');
const showBtn = document.getElementById('show-controls-btn');
const controlsWrapper = document.getElementById('controls-wrapper');

hideBtn.addEventListener('click', () => {
  controlsWrapper.style.transform = 'translateY(100%)';
  controlsWrapper.style.opacity = '0';
  controlsWrapper.style.pointerEvents = 'none';

  setTimeout(() => showBtn.classList.remove('hidden'), 300);
});

showBtn.addEventListener('click', () => {
  showBtn.classList.add('hidden');
  controlsWrapper.style.transform = 'translateY(0)';
  controlsWrapper.style.opacity = '1';
  controlsWrapper.style.pointerEvents = 'auto';
});

/* ================================================================ */
/* Ниже — твой код без изменений (PDF.js, fullscreen, swipe и т.д.) */
/* ================================================================ */

</script>

</body>
</html>
